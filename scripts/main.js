"use strict";function PlaceModel(e,t,o){var a=this;this.MARKER_PATH="https://maps.gstatic.com/intl/en_us/mapfiles/marker_green",this.placeId=ko.observable(e.place_id),this.orderId=ko.observable(t),this.location=ko.observable(e.geometry.location),this.lat=ko.observable(e.geometry.location.lat()),this.lng=ko.observable(e.geometry.location.lng()),this.markerLetter=ko.observable(String.fromCharCode("A".charCodeAt(0)+a.orderId())),this.markerIcon=ko.computed(function(){return a.MARKER_PATH+a.markerLetter()+".png"}),this.name=ko.observable(e.name),this.styleBgColor=ko.computed(function(){return a.orderId()%2===0?"#F0F0F0":"#FFFFFF"}),this.icon=ko.observable(e.icon),this.marker=ko.observable(new google.maps.Marker({position:a.location(),animation:google.maps.Animation.DROP,icon:a.markerIcon()})),this.marker().placeId=a.placeId(),this.show=ko.computed(function(){var e=!0;return o()&&(e=a.name().toLowerCase().indexOf(o().toLowerCase())>=0),a.marker().setVisible(e),e})}function DetailModel(e){var t=this;this.hostnameRegexp=new RegExp("^https?://.+?/"),this.icon=ko.observable(e.icon),this.name=ko.observable(e.name),this.vicinity=ko.observable(e.vicinity),this.phoneNumber=ko.observable(e.formatted_phone_number),this.address=ko.observable(e.formatted_address),this.website=ko.computed(function(){var o;return e.website?(o=t.hostnameRegexp.exec(e.website),null===o&&(o="http://"+e.website+"/")):o="none",o}),this.rating=ko.computed(function(){var t="";if(e.rating)for(var o=0;5>o;o++)t+=e.rating<o+.5?"&#10025;":"&#10029;";else t="none";return t})}function ArticleModel(e,t){var o=this;this.title=ko.observable(e.title),this.pageid=ko.observable(e.pageid),this.link=ko.computed(function(){return"https://en.wikipedia.org/?curid="+o.pageid()}),this.show=ko.computed(function(){var e=!0;return t()&&(e=o.title().toLowerCase().indexOf(t().toLowerCase())>=0),e})}function PhotoModel(e){var t=this;this.farm=ko.observable(e.farm),this.server=ko.observable(e.server),this.id=ko.observable(e.id),this.secret=ko.observable(e.secret),this.owner=ko.observable(e.owner),this.url=ko.computed(function(){return"http://farm"+t.farm()+".static.flickr.com/"+t.server()+"/"+t.id()+"_"+t.secret()+"_m.jpg"}),this.attributionLink=ko.computed(function(){return"https://www.flickr.com/photos/"+t.owner()+"/"+t.id()})}function AppViewModel(){function e(e){return function(){h.placeList()[e].marker().setMap(l)}}function t(){for(var e=0;e<h.placeList().length;e++)h.placeList()[e]&&h.placeList()[e].marker().setMap(null);h.placeList.removeAll(),h.articleList.removeAll(),h.photoList.removeAll(),h.bounds=new google.maps.LatLngBounds,h.searchFrom("")}function o(){var e;e="mobile"===h.searchFrom()?h.autocompleteMobile.getPlace():h.autocomplete.getPlace(),e.geometry?(l.panTo(e.geometry.location),l.setZoom(15),h.basePlace(new PlaceModel(e,0,h.query)),r()):document.getElementById("autocomplete").placeholder="Enter a location"}function a(){var e=this;c.getDetails({placeId:e.placeId},function(t,o){o===google.maps.places.PlacesServiceStatus.OK&&(h.currentPlace(new DetailModel(t)),u.open(l,e))}),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},3e3)}function r(){var o={bounds:l.getBounds(),types:["store","school","hospital","food"],radius:"50"};c.nearbySearch(o,function(o,r){if(r===google.maps.places.PlacesServiceStatus.OK){t();for(var n=0;n<o.length;n++)h.placeList.push(new PlaceModel(o[n],n,h.query)),google.maps.event.addListener(h.placeList()[n].marker(),"click",a),setTimeout(e(n),100*n),h.bounds.extend(o[n].geometry.location),l.fitBounds(h.bounds);i(),s()}})}function i(){var e="Oh, snap! Something has gone wrong with Wikipedia!  Did you remember to make your donation? Yeah, me either.... maybe just refresh the page? Specifically I captured this error: ",t=setTimeout(function(){alertify.alert(e)},8e3),o="http://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord=";o=o+h.basePlace().lat()+"%7C"+h.basePlace().lng()+"&format=json",$.ajax({url:o,crossDomain:!0,dataType:"jsonp",success:function(e){wikiData=e.query.geosearch,clearTimeout(t)},error:function(t,o){0===t.status?alertify.alert(e+"Not connect.n Verify Network."):404===t.status?alertify.alert(e+"Requested page not found. [404]"):500===t.status?alertify.alert(e+"Internal Server Error [500]."):"parsererror"===o?alertify.alert(e+"Requested JSON parse failed."):"timeout"===o?alertify.alert(e+"Time out error."):"abort"===o?alertify.alert(e+"Ajax request aborted."):alertify.alert(e+"Uncaught Error.n"+t.responseText)}}).done(function(){wikiData.forEach(function(e){h.articleList.push(new ArticleModel(e,h.query))})})}function s(){var e=h.basePlace().lat(),t=h.basePlace().lng(),o="https://www.flickr.com/services/rest/?method=flickr.photos.search&format=json",a="6c50d3c0a8cd35d228fd25d74f2f663c",r=1,i="interestingness-desc",s=1,n="mi",l=1,c=10,u=o+"&api_key="+a+"&safe_search="+r+"&sort="+i+"&lat="+e+"&lon="+t+"&radius="+s+"&radius_units="+n+"&content_type="+l+"&per_page="+c+"&format=json&jsoncallback=?";$.getJSON(u,function(e){var t=setTimeout(function(){alertify.alert("We failed to get flickr photos in a timely fashion.  :( Bummer, I know.")},1e4),o=10;e.photos.photo.length>0?($.each(e.photos.photo,function(e,t){return h.photoList.push(new PhotoModel(t)),e===o-1?($imageElem.justifiedGallery({rowHeight:70,margins:3,lastRow:"justify"}),!1):void 0}),clearTimeout(t)):alertify.alert("Sadly there are no photos in the area that are public.")}).fail(function(e){alertify.alert("Flickr Data is not available. Specifically I captured the following error: "+e)})}function n(){l=new google.maps.Map(document.getElementById("map"),{center:{lat:33.3539759,lng:-111.7152599},zoom:13}),u=new google.maps.InfoWindow({content:document.getElementById("info-content")}),c=new google.maps.places.PlacesService(l);var e=document.getElementById("autocomplete"),t=document.getElementById("dataFilter");l.controls[google.maps.ControlPosition.TOP_LEFT].push(e),l.controls[google.maps.ControlPosition.TOP_LEFT].push(t),h.autocomplete.addListener("place_changed",function(){h.searchFrom("desktop")}),h.autocomplete.addListener("place_changed",o),h.autocompleteMobile.addListener("place_changed",function(){h.searchFrom("mobile")}),h.autocompleteMobile.addListener("place_changed",o)}var l,c,u,h=this;this.bounds=new google.maps.LatLngBounds,this.articleList=ko.observableArray([]),this.photoList=ko.observableArray([]),this.placeList=ko.observableArray([]),this.currentPlace=ko.observable(),this.basePlace=ko.observable(),this.query=ko.observable(""),this.searchBox=ko.observable(document.getElementById("autocomplete")),this.searchBoxMobile=ko.observable(document.getElementById("autocompleteMobile")),this.autocomplete=new google.maps.places.Autocomplete(h.searchBox(),{}),this.autocompleteMobile=new google.maps.places.Autocomplete(h.searchBoxMobile(),{}),this.searchFrom=ko.observable(),h.ahClickIt=function(e){google.maps.event.trigger(e.marker(),"click")},"undefined"==typeof google||null===google?alertify.alert("Shucks!  Something went terribly terribly wrong with the googles. The universe just wants you to try harder.  Please refesh the page a few times. :)"):n()}function initApp(){ko.applyBindings(new AppViewModel)}function googleError(){alertify.alert("Shucks!  Something went terribly terribly wrong with the googles. The universe just wants you to try harder.  Please refesh the page a few times. :)")}var wikiData=ko.observableArray([]),$imageElem=$("#images");