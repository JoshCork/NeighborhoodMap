"use strict";function onPlaceChanged(){var e=autocomplete.getPlace();e.geometry?(map.panTo(e.geometry.location),map.setZoom(15),search(),getWikipediaNearby(e),getFlickrPhotos(e.geometry.location.lat(),e.geometry.location.lng())):document.getElementById("autocomplete").placeholder="Enter a city"}function search(){var e={bounds:map.getBounds(),types:["school","store","food"],radius:1e3};places.nearbySearch(e,function(e,t){if(t===google.maps.places.PlacesServiceStatus.OK){clearResults(),clearMarkers();for(var o=0;o<e.length;o++){var n=String.fromCharCode("A".charCodeAt(0)+o),a=MARKER_PATH+n+".png";markers[o]=new google.maps.Marker({position:e[o].geometry.location,animation:google.maps.Animation.DROP,icon:a}),markers[o].placeResult=e[o],google.maps.event.addListener(markers[o],"click",showInfoWindow),setTimeout(dropMarker(o),100*o),addResult(e[o],o)}}})}function clearMarkers(){for(var e=0;e<markers.length;e++)markers[e]&&markers[e].setMap(null);markers=[]}function dropMarker(e){return function(){markers[e].setMap(map)}}function addResult(e,t){var o=document.getElementById("results"),n=String.fromCharCode("A".charCodeAt(0)+t),a=MARKER_PATH+n+".png";myPlaces.push(e);var i=document.createElement("tr");i.style.backgroundColor=t%2===0?"#F0F0F0":"#FFFFFF",i.onclick=function(){google.maps.event.trigger(markers[t],"click")};var r=document.createElement("td"),l=document.createElement("td"),s=document.createElement("img");s.src=a,s.setAttribute("class","placeIcon"),s.setAttribute("className","placeIcon");var c=document.createTextNode(e.name);r.appendChild(s),l.appendChild(c),i.appendChild(r),i.appendChild(l),o.appendChild(i)}function clearResults(){for(var e=document.getElementById("results");e.childNodes[0];)e.removeChild(e.childNodes[0]);myPlaces=[],$("#results").empty(),$("#images").empty(),$("#wikipedia-links").empty()}function buildIWContent(e){if(document.getElementById("iw-icon").innerHTML='<img class="hotelIcon"src='+e.icon+"/>",document.getElementById("iw-url").innerHTML="<b><a href="+e.url+">"+e.name+"</a></b>",document.getElementById("iw-address").textContent=e.vicinity,e.formatted_phone_number?(document.getElementById("iw-phone-row").style.display="",document.getElementById("iw-phone").textContent=e.formatted_phone_number):document.getElementById("iw-phone-row").style.display="none",e.rating)for(var t="",o=0;5>o;o++)t+=e.rating<o+.5?"&#10025;":"&#10029;",document.getElementById("iw-rating-row").style.display="",document.getElementById("iw-rating").innerHTML=t;else document.getElementById("iw-rating-row").style.display="none";if(e.website){var n=e.website,a=hostnameRegexp.exec(e.website);null===a&&(a="http://"+e.website+"/",n=a),document.getElementById("iw-website-row").style.display="",document.getElementById("iw-website").textContent=a}else document.getElementById("iw-website-row").style.display="none"}function showInfoWindow(){var e=this;places.getDetails({placeId:e.placeResult.place_id},function(t,o){o===google.maps.places.PlacesServiceStatus.OK&&(infoWindow.open(map,e),buildIWContent(t))})}function getWikipediaNearby(e){var t="http://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord="+e.geometry.location.lat()+"%7C"+e.geometry.location.lng()+"&format=json",o=setTimeout(function(){$wikiElem.text("failed to get Wikipedia resources.")},8e3);$.ajax({url:t,crossDomain:!0,dataType:"jsonp",success:function(e){var t=[],n="https://en.wikipedia.org/?curid=";console.log("Wikipedia Results: "+e),console.log("title of first result: "+e.query.geosearch[0].title),$.each(e.query.geosearch,function(e,o){t.push('<li class="article" id=""'+e+"><a href="+n+this.pageid+' target="_blank">'+this.title+"</a></li>"),console.log("i have pushed to WikiArray")}),clearTimeout(o),$("<ul/>",{id:"wikipedia-links",html:t.join("")}).appendTo(".wikipedia-container")},error:function(e){console.log("I am the error: "+e)}})}function getFlickrPhotos(e,t){var o,n="https://www.flickr.com/services/rest/?method=flickr.photos.search&format=json",a="6c50d3c0a8cd35d228fd25d74f2f663c",i=1,r="interestingness-desc",l=10,s="mi",c=1,m=10,d=n+"&api_key="+a+"&safe_search="+i+"&sort="+r+"&lat="+e+"&lon="+t+"&radius="+l+"&radius_units="+s+"&content_type="+c+"&per_page="+m;$.getJSON(d+"&format=json&jsoncallback=?",function(e){console.log("flickr photos are coming!"),console.log(e),$.each(e.photos.photo,function(e,t){return o="http://farm"+t.farm+".static.flickr.com/"+t.server+"/"+t.id+"_"+t.secret+"_m.jpg",$("<img/>").attr("src",o).appendTo("#images"),3===e?!1:void 0})})}function getWeather(){$(document).ready(function(){$.simpleWeather({location:"Austin, TX",woeid:"",unit:"f",success:function(e){var t='<h2><i class="icon-'+e.code+'"></i> '+e.temp+"&deg;"+e.units.temp+"</h2>";t+="<ul><li>"+e.city+", "+e.region+"</li>",t+='<li class="currently">'+e.currently+"</li>",t+="<li>"+e.wind.direction+" "+e.wind.speed+" "+e.units.speed+"</li></ul>",$("#weather").html(t)},error:function(e){$("#weather").html("<p>"+e+"</p>")}})})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:33.3539759,lng:-111.7152599},zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP}),infoWindow=new google.maps.InfoWindow({content:document.getElementById("info-content")}),autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{}),places=new google.maps.places.PlacesService(map);var e=document.getElementById("autocomplete");map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),autocomplete.addListener("place_changed",onPlaceChanged)}console.log("'Allo 'Allo!");var map,places,infoWindow,markers=[],autocomplete,$wikiElem=$("#wikipedia-links"),MARKER_PATH="https://maps.gstatic.com/intl/en_us/mapfiles/marker_green",hostnameRegexp=new RegExp("^https?://.+?/"),myPlaces=[];