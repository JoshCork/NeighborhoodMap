"use strict";function onPlaceChanged(){var e=autocomplete.getPlace();e.geometry?(map.panTo(e.geometry.location),map.setZoom(15),search(),getWikipediaNearby(e),getFlickrPhotos(e.geometry.location.lat(),e.geometry.location.lng())):document.getElementById("autocomplete").placeholder="Enter a city"}function search(){var e={bounds:map.getBounds(),types:["school","store","food"],radius:1e3};places.nearbySearch(e,function(e,t){if(t===google.maps.places.PlacesServiceStatus.OK){clearResults(),clearMarkers();for(var o=0;o<e.length;o++){var n=String.fromCharCode("A".charCodeAt(0)+o),a=MARKER_PATH+n+".png";markers[o]=new google.maps.Marker({position:e[o].geometry.location,animation:google.maps.Animation.DROP,icon:a}),markers[o].placeResult=e[o],google.maps.event.addListener(markers[o],"click",showInfoWindow),setTimeout(dropMarker(o),100*o),addResult(e[o],o)}}})}function clearMarkers(){for(var e=0;e<markers.length;e++)markers[e]&&markers[e].setMap(null);markers=[]}function dropMarker(e){return function(){markers[e].setMap(map)}}function addResult(e,t){var o=document.getElementById("results"),n=String.fromCharCode("A".charCodeAt(0)+t),a=MARKER_PATH+n+".png",i=document.createElement("tr"),r=document.createElement("td"),l=document.createElement("td"),s=document.createElement("img"),c=document.createTextNode(e.name);i.style.backgroundColor=t%2===0?"#F0F0F0":"#FFFFFF",i.onclick=function(){google.maps.event.trigger(markers[t],"click")},s.src=a,s.setAttribute("class","placeIcon"),s.setAttribute("className","placeIcon"),r.appendChild(s),l.appendChild(c),i.appendChild(r),i.appendChild(l),o.appendChild(i)}function clearResults(){$imageElem.empty(),$wikiElem.empty(),$("#results").empty()}function buildIWContent(e){if(document.getElementById("iw-icon").innerHTML='<img class="hotelIcon"src='+e.icon+"/>",document.getElementById("iw-url").innerHTML="<b><a href="+e.url+">"+e.name+"</a></b>",document.getElementById("iw-address").textContent=e.vicinity,e.formatted_phone_number?(document.getElementById("iw-phone-row").style.display="",document.getElementById("iw-phone").textContent=e.formatted_phone_number):document.getElementById("iw-phone-row").style.display="none",e.rating)for(var t="",o=0;5>o;o++)t+=e.rating<o+.5?"&#10025;":"&#10029;",document.getElementById("iw-rating-row").style.display="",document.getElementById("iw-rating").innerHTML=t;else document.getElementById("iw-rating-row").style.display="none";if(e.website){var n=hostnameRegexp.exec(e.website);null===n&&(n="http://"+e.website+"/"),document.getElementById("iw-website-row").style.display="",document.getElementById("iw-website").textContent=n}else document.getElementById("iw-website-row").style.display="none"}function showInfoWindow(){var e=this;places.getDetails({placeId:e.placeResult.place_id},function(t,o){o===google.maps.places.PlacesServiceStatus.OK&&(infoWindow.open(map,e),buildIWContent(t))})}function renderWikiDetails(e){var t=setTimeout(function(){$wikiElem.text("failed to get Wikipedia resources.")},1e4),o=[],n="https://en.wikipedia.org/?curid=";$.each(e.query.geosearch,function(e,t){o.push('<li class="article" id=""'+e+"><a href="+n+this.pageid+' target="_blank">'+this.title+"</a></li>")}),clearTimeout(t),$(o.join("")).appendTo("#wikipedia-links")}function getWikipediaNearby(e){var t="http://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord="+e.geometry.location.lat()+"%7C"+e.geometry.location.lng()+"&format=json";$.ajax({url:t,crossDomain:!0,dataType:"jsonp",jsonpCallback:"renderWikiDetails",error:function(e){console.log("I am the error: "+e)}})}function renderFlikrPhotos(e){var t,o=setTimeout(function(){$imageElem.text("failed to get flickr photos in a timely fashion.  :( Bummer, I know.")},1e4),n=10;e.photos.photo.length>0?($.each(e.photos.photo,function(e,o){return t="http://farm"+o.farm+".static.flickr.com/"+o.server+"/"+o.id+"_"+o.secret+"_m.jpg",$("<img/>").attr("src",t).appendTo("#images").wrap('<a href="https://www.flickr.com/photos/'+o.owner+"/"+o.id+'" target="_blank"></a>'),e===n-1?($imageElem.justifiedGallery({rowHeight:70,margins:3,lastRow:"justify"}),!1):void 0}),clearTimeout(o)):$imageElem.append("<p> sadly, there are no images to be found.</p>")}function getFlickrPhotos(e,t){var o="https://www.flickr.com/services/rest/?method=flickr.photos.search&format=json",n="6c50d3c0a8cd35d228fd25d74f2f663c",a=1,i="interestingness-desc",r=10,l="mi",s=1,c=10,m=o+"&api_key="+n+"&safe_search="+a+"&sort="+i+"&lat="+e+"&lon="+t+"&radius="+r+"&radius_units="+l+"&content_type="+s+"&per_page="+c;$.getJSON(m+"&format=json&jsoncallback=?",renderFlikrPhotos)}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:33.3539759,lng:-111.7152599},zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP}),infoWindow=new google.maps.InfoWindow({content:document.getElementById("info-content")}),autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{}),places=new google.maps.places.PlacesService(map);var e=document.getElementById("autocomplete");map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),autocomplete.addListener("place_changed",onPlaceChanged)}console.log("'Allo 'Allo!");var map,places,infoWindow,markers=[],autocomplete,MARKER_PATH="https://maps.gstatic.com/intl/en_us/mapfiles/marker_green",hostnameRegexp=new RegExp("^https?://.+?/"),$wikiElem=$("#wikipedia-links"),$imageElem=$("#images");