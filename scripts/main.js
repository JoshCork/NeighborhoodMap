"use strict";function PlaceModel(e,o,t){var a=this;this.MARKER_PATH="https://maps.gstatic.com/intl/en_us/mapfiles/marker_green",this.placeId=ko.observable(e.place_id),this.orderId=ko.observable(o),this.location=ko.observable(e.geometry.location),this.lat=ko.observable(e.geometry.location.lat()),this.lng=ko.observable(e.geometry.location.lng()),this.markerLetter=ko.observable(String.fromCharCode("A".charCodeAt(0)+a.orderId())),this.markerIcon=ko.computed(function(){return a.MARKER_PATH+a.markerLetter()+".png"}),this.name=ko.observable(e.name),this.styleBgColor=ko.computed(function(){return a.orderId()%2===0?"#F0F0F0":"#FFFFFF"}),this.icon=ko.observable(e.icon),this.marker=ko.observable(new google.maps.Marker({position:a.location(),animation:google.maps.Animation.DROP,icon:a.markerIcon()})),this.marker().placeId=a.placeId(),this.show=ko.computed(function(){var e=!0;return t()&&(e=a.name().toLowerCase().indexOf(t().toLowerCase())>=0),a.marker().setVisible(e),e})}function DetailModel(e){var o=this;this.hostnameRegexp=new RegExp("^https?://.+?/"),this.icon=ko.observable(e.icon),this.name=ko.observable(e.name),this.vicinity=ko.observable(e.vicinity),this.phoneNumber=ko.observable(e.formatted_phone_number),this.address=ko.observable(e.formatted_address),this.website=ko.computed(function(){var t;return e.website?(t=o.hostnameRegexp.exec(e.website),null===t&&(t="http://"+e.website+"/")):t="none",t}),this.rating=ko.computed(function(){var o="";if(e.rating)for(var t=0;5>t;t++)o+=e.rating<t+.5?"&#10025;":"&#10029;";else o="none";return o})}function ArticleModel(e,o){var t=this;this.title=ko.observable(e.title),this.pageid=ko.observable(e.pageid),this.link=ko.computed(function(){return"https://en.wikipedia.org/?curid="+t.pageid()}),this.show=ko.computed(function(){var e=!0;return o()&&(e=t.title().toLowerCase().indexOf(o().toLowerCase())>=0),e})}function PhotoModel(e){var o=this;this.farm=ko.observable(e.farm),this.server=ko.observable(e.server),this.id=ko.observable(e.id),this.secret=ko.observable(e.secret),this.owner=ko.observable(e.owner),this.url=ko.computed(function(){return"http://farm"+o.farm()+".static.flickr.com/"+o.server()+"/"+o.id()+"_"+o.secret()+"_m.jpg"}),this.attributionLink=ko.computed(function(){return"https://www.flickr.com/photos/"+o.owner()+"/"+o.id()})}function AppViewModel(){function e(e){return function(){p.placeList()[e].marker().setMap(l)}}function o(){for(var e=0;e<p.placeList().length;e++)p.placeList()[e]&&p.placeList()[e].marker().setMap(null);p.placeList.removeAll(),p.articleList.removeAll(),p.photoList.removeAll(),p.bounds=new google.maps.LatLngBounds,p.searchFrom("")}function t(){console.log("self.searchFrom(): "+p.searchFrom());var e;e="mobile"===p.searchFrom()?p.autocompleteMobile.getPlace():p.autocomplete.getPlace(),console.log(e),e.geometry?(l.panTo(e.geometry.location),l.setZoom(15),p.basePlace(new PlaceModel(e,0,p.query)),i()):document.getElementById("autocomplete").placeholder="Enter a location"}function a(){var e=this;c.getDetails({placeId:e.placeId},function(o,t){t===google.maps.places.PlacesServiceStatus.OK&&(p.currentPlace(new DetailModel(o)),m.open(l,e))}),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},3e3)}function i(){var t={bounds:l.getBounds(),types:["store","school","hospital","food"],radius:"50"};c.nearbySearch(t,function(t,i){if(i===google.maps.places.PlacesServiceStatus.OK){o();for(var n=0;n<t.length;n++)p.placeList.push(new PlaceModel(t[n],n,p.query)),google.maps.event.addListener(p.placeList()[n].marker(),"click",a),setTimeout(e(n),100*n),p.bounds.extend(t[n].geometry.location),l.fitBounds(p.bounds);r(),s()}})}function r(){var e="http://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord=";e=e+p.basePlace().lat()+"%7C"+p.basePlace().lng()+"&format=json",$.ajax({url:e,crossDomain:!0,dataType:"jsonp",success:function(e){wikiData=e.query.geosearch},error:function(e){console.log("I am the error: "+e)}}).done(function(){wikiData.forEach(function(e){p.articleList.push(new ArticleModel(e,p.query))})})}function s(){var e=p.basePlace().lat(),o=p.basePlace().lng(),t="https://www.flickr.com/services/rest/?method=flickr.photos.search&format=json",a="6c50d3c0a8cd35d228fd25d74f2f663c",i=1,r="interestingness-desc",s=1,n="mi",l=1,c=10,m=t+"&api_key="+a+"&safe_search="+i+"&sort="+r+"&lat="+e+"&lon="+o+"&radius="+s+"&radius_units="+n+"&content_type="+l+"&per_page="+c+"&format=json&jsoncallback=?";$.getJSON(m,function(e){var o=setTimeout(function(){alertify.alert("We failed to get flickr photos in a timely fashion.  :( Bummer, I know.")},1e4),t=10;e.photos.photo.length>0?($.each(e.photos.photo,function(e,o){return p.photoList.push(new PhotoModel(o)),e===t-1?($imageElem.justifiedGallery({rowHeight:70,margins:3,lastRow:"justify"}),!1):void 0}),clearTimeout(o)):alertify.alert("Sadly there are no photos in the area that are public.")}).fail(function(e){console.log(e),alertify.alert("Flickr Data is not available.")})}function n(){l=new google.maps.Map(document.getElementById("map"),{center:{lat:33.3539759,lng:-111.7152599},zoom:13}),m=new google.maps.InfoWindow({content:document.getElementById("info-content")}),c=new google.maps.places.PlacesService(l);var e=document.getElementById("autocomplete"),o=document.getElementById("dataFilter");l.controls[google.maps.ControlPosition.TOP_LEFT].push(e),l.controls[google.maps.ControlPosition.TOP_LEFT].push(o),p.autocomplete.addListener("place_changed",function(){p.searchFrom("desktop")}),p.autocomplete.addListener("place_changed",t),p.autocompleteMobile.addListener("place_changed",function(){p.searchFrom("mobile")}),p.autocompleteMobile.addListener("place_changed",t)}var l,c,m,p=this;this.bounds=new google.maps.LatLngBounds,this.articleList=ko.observableArray([]),this.photoList=ko.observableArray([]),this.placeList=ko.observableArray([]),this.currentPlace=ko.observable(),this.basePlace=ko.observable(),this.query=ko.observable(""),this.searchBox=ko.observable(document.getElementById("autocomplete")),this.searchBoxMobile=ko.observable(document.getElementById("autocompleteMobile")),this.autocomplete=new google.maps.places.Autocomplete(p.searchBox(),{}),this.autocompleteMobile=new google.maps.places.Autocomplete(p.searchBoxMobile(),{}),this.searchFrom=ko.observable(),p.ahClickIt=function(e){google.maps.event.trigger(e.marker(),"click")},n()}function initApp(){ko.applyBindings(new AppViewModel)}var wikiData=ko.observableArray([]),$imageElem=$("#images");