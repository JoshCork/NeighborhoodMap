"use strict";function PlaceModel(e,o,t){var a=this;this.MARKER_PATH="https://maps.gstatic.com/intl/en_us/mapfiles/marker_green",this.placeId=ko.observable(e.place_id),this.orderId=ko.observable(o),this.location=ko.observable(e.geometry.location),this.lat=ko.observable(e.geometry.location.lat()),this.lng=ko.observable(e.geometry.location.lng()),this.markerLetter=ko.observable(String.fromCharCode("A".charCodeAt(0)+a.orderId())),this.markerIcon=ko.computed(function(){return a.MARKER_PATH+a.markerLetter()+".png"}),this.name=ko.observable(e.name),this.styleBgColor=ko.computed(function(){return a.orderId()%2===0?"#F0F0F0":"#FFFFFF"}),this.icon=ko.observable(e.icon),this.marker=ko.observable(new google.maps.Marker({position:a.location(),animation:google.maps.Animation.DROP,icon:a.markerIcon()})),this.marker().placeId=a.placeId(),this.show=ko.computed(function(){var e=!0;return t()&&(e=a.name().toLowerCase().indexOf(t().toLowerCase())>=0),a.marker().setVisible(e),e})}function DetailModel(e){var o=this;this.hostnameRegexp=new RegExp("^https?://.+?/"),this.icon=ko.observable(e.icon),this.name=ko.observable(e.name),this.vicinity=ko.observable(e.vicinity),this.phoneNumber=ko.observable(e.formatted_phone_number),this.address=ko.observable(e.formatted_address),this.website=ko.computed(function(){var t;return e.website?(t=o.hostnameRegexp.exec(e.website),null===t&&(t="http://"+e.website+"/")):t="none",t}),this.rating=ko.computed(function(){var o="";if(e.rating)for(var t=0;5>t;t++)o+=e.rating<t+.5?"&#10025;":"&#10029;";else o="none";return o})}function ArticleModel(e,o){var t=this;this.title=ko.observable(e.title),this.pageid=ko.observable(e.pageid),this.link=ko.computed(function(){return"https://en.wikipedia.org/?curid="+t.pageid()}),this.show=ko.computed(function(){var e=!0;return o()&&(e=t.title().toLowerCase().indexOf(o().toLowerCase())>=0),e})}function PhotoModel(e){var o=this;this.farm=ko.observable(e.farm),this.server=ko.observable(e.server),this.id=ko.observable(e.id),this.secret=ko.observable(e.secret),this.owner=ko.observable(e.owner),this.url=ko.computed(function(){return"http://farm"+o.farm()+".static.flickr.com/"+o.server()+"/"+o.id()+"_"+o.secret()+"_m.jpg"}),this.attributionLink=ko.computed(function(){return"https://www.flickr.com/photos/"+o.owner()+"/"+o.id()})}function AppViewModel(){function e(e){return function(){h.placeList()[e].marker().setMap(l)}}function o(){for(var e=0;e<h.placeList().length;e++)h.placeList()[e]&&h.placeList()[e].marker().setMap(null);h.placeList.removeAll(),h.articleList.removeAll(),h.photoList.removeAll(),h.bounds=new google.maps.LatLngBounds,h.searchFrom("")}function t(){var e;e="mobile"===h.searchFrom()?h.autocompleteMobile.getPlace():h.autocomplete.getPlace(),e.geometry?(l.panTo(e.geometry.location),l.setZoom(15),h.basePlace(new PlaceModel(e,0,h.query)),r()):document.getElementById("autocomplete").placeholder="Enter a location"}function a(){var e=this;c.getDetails({placeId:e.placeId},function(o,t){t===google.maps.places.PlacesServiceStatus.OK&&(h.currentPlace(new DetailModel(o)),u.open(l,e))}),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},3e3)}function r(){var t={bounds:l.getBounds(),types:["store","school","hospital","food"],radius:"50"};c.nearbySearch(t,function(t,r){if(r===google.maps.places.PlacesServiceStatus.OK){o();for(var n=0;n<t.length;n++)h.placeList.push(new PlaceModel(t[n],n,h.query)),google.maps.event.addListener(h.placeList()[n].marker(),"click",a),setTimeout(e(n),100*n),h.bounds.extend(t[n].geometry.location),l.fitBounds(h.bounds);i(),s()}})}function i(){var e="http://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord=";e=e+h.basePlace().lat()+"%7C"+h.basePlace().lng()+"&format=json",$.ajax({url:e,crossDomain:!0,dataType:"jsonp",success:function(e){wikiData=e.query.geosearch},error:function(e){console.log("I am the error: "+e)}}).done(function(){wikiData.forEach(function(e){h.articleList.push(new ArticleModel(e,h.query))})})}function s(){var e=h.basePlace().lat(),o=h.basePlace().lng(),t="https://www.flickr.com/services/rest/?method=flickr.photos.search&format=json",a="6c50d3c0a8cd35d228fd25d74f2f663c",r=1,i="interestingness-desc",s=1,n="mi",l=1,c=10,u=t+"&api_key="+a+"&safe_search="+r+"&sort="+i+"&lat="+e+"&lon="+o+"&radius="+s+"&radius_units="+n+"&content_type="+l+"&per_page="+c+"&format=json&jsoncallback=?";$.getJSON(u,function(e){var o=setTimeout(function(){alertify.alert("We failed to get flickr photos in a timely fashion.  :( Bummer, I know.")},1e4),t=10;e.photos.photo.length>0?($.each(e.photos.photo,function(e,o){return h.photoList.push(new PhotoModel(o)),e===t-1?($imageElem.justifiedGallery({rowHeight:70,margins:3,lastRow:"justify"}),!1):void 0}),clearTimeout(o)):alertify.alert("Sadly there are no photos in the area that are public.")}).fail(function(e){console.log(e),alertify.alert("Flickr Data is not available.")})}function n(){l=new google.maps.Map(document.getElementById("map"),{center:{lat:33.3539759,lng:-111.7152599},zoom:13}),u=new google.maps.InfoWindow({content:document.getElementById("info-content")}),c=new google.maps.places.PlacesService(l);var e=document.getElementById("autocomplete"),o=document.getElementById("dataFilter");l.controls[google.maps.ControlPosition.TOP_LEFT].push(e),l.controls[google.maps.ControlPosition.TOP_LEFT].push(o),h.autocomplete.addListener("place_changed",function(){h.searchFrom("desktop")}),h.autocomplete.addListener("place_changed",t),h.autocompleteMobile.addListener("place_changed",function(){h.searchFrom("mobile")}),h.autocompleteMobile.addListener("place_changed",t)}var l,c,u,h=this;this.bounds=new google.maps.LatLngBounds,this.articleList=ko.observableArray([]),this.photoList=ko.observableArray([]),this.placeList=ko.observableArray([]),this.currentPlace=ko.observable(),this.basePlace=ko.observable(),this.query=ko.observable(""),this.searchBox=ko.observable(document.getElementById("autocomplete")),this.searchBoxMobile=ko.observable(document.getElementById("autocompleteMobile")),this.autocomplete=new google.maps.places.Autocomplete(h.searchBox(),{}),this.autocompleteMobile=new google.maps.places.Autocomplete(h.searchBoxMobile(),{}),this.searchFrom=ko.observable(),h.ahClickIt=function(e){google.maps.event.trigger(e.marker(),"click")},"undefined"==typeof google||null===google?alertify.alert("Shucks!  Something went terribly terribly wrong with the googles. The universe just wants you to try harder.  Please refesh the page a few times. :)"):n()}function initApp(){ko.applyBindings(new AppViewModel)}function googleError(){alertify.alert("Shucks!  Something went terribly terribly wrong with the googles. The universe just wants you to try harder.  Please refesh the page a few times. :)")}var wikiData=ko.observableArray([]),$imageElem=$("#images");